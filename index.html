<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Calculator | Расчёт орбитальных переходов</title>
    
    <!-- Favicon Configuration -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Подключение шрифтов -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        @font-face {
            font-family: 'GOST';
            src: url('fonts/gost_common.woff2') format('woff2'),
                 url('fonts/gost_common.woff') format('woff'),
                 url('fonts/gost_common.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        :root {
            /* Тёмная тема (более тёмная) */
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #0400ff;
            --background: #0d0d17;
            --card: #1a1a2e;
            --text: #e0e0e0;
            --error: #e94560;
            --header-bg: #1a1a2e;
            --results-bg: #16213e;
            --footer-color: #9e9e9e;
            --sidebar-bg: #1a1a2e;
            --toggle-bg: #4a4a8a;
            --toggle-handle: #5c6bc0;
            --border: #2d2d4d;
            --russian-font: 'GOST', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --english-font: 'Orbitron', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .light-theme {
            /* Обновлённая светлая тема в оливковых тонах */
            --primary: #eef3c8;
            --secondary: #e5f38b;
            --accent: #5a7e05;
            --background: #f2f4e7;
            --card: #e8f5d0;
            --text: #333333;
            --error: #c44d58;
            --header-bg: #f0f2e1;
            --results-bg: #e6e9d1;
            --footer-color: #757575;
            --sidebar-bg: #f0f2e1;
            --toggle-bg: #c8ccaa;
            --toggle-handle: #636B2F;
            --border: #d0d3b5;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s, transform 0.3s, opacity 0.3s;
            font-family: var(--russian-font); /* Применяем ГОСТ по умолчанию ко всем элементам */
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        body.english {
            font-family: var(--english-font); /* Orbitron для английской версии */
        }

        body.english * {
            font-family: var(--english-font) !important; /* Принудительно для всех дочерних элементов */
        }

        /* Специальные символы - сохраняем системный шрифт */
        .symbol {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body.english .symbol {
            font-family: var(--english-font); /* Для английской версии символы в Orbitron */
        }

        /* Элементы форм */
        select, input, textarea, button, option {
            font-family: inherit !important; /* Наследуем основной шрифт */
        }

        /* Результаты расчёта - моноширинный шрифт */
        .results {
            font-family: monospace;
        }

        header {
            background: var(--header-bg);
            color: var(--text);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            border: 1px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            transition: grid-template-areas 0.3s ease;
        }

        /* Стандартный порядок */
        .container.default {
            grid-template-areas: 
                "card1"
                "card2"
                "card3"
                "card4";
        }
        
        /* Результаты сверху */
        .container.results-top {
            grid-template-areas: 
                "card4"
                "card1"
                "card2"
                "card3";
        }
        
        /* Целевая орбита сверху */
        .container.target-top {
            grid-template-areas: 
                "card3"
                "card1"
                "card2"
                "card4";
        }
        
        /* Параметры тела сверху */
        .container.wide-first {
            grid-template-areas: 
                "card1"
                "card2"
                "card3"
                "card4";
        }

        /* Назначаем областям карточки */
        .card:nth-child(1) { grid-area: card1; }
        .card:nth-child(2) { grid-area: card2; }
        .card:nth-child(3) { grid-area: card3; }
        .card:nth-child(4) { grid-area: card4; }

        @media (min-width: 900px) {
            .container.default {
                grid-template-columns: 1fr 1fr;
                grid-template-areas: 
                    "card1 card2"
                    "card4 card3";
            }
            
            .container.results-top {
                grid-template-columns: 1fr 1fr;
                grid-template-areas: 
                    "card4 card4"
                    "card1 card2"
                    "card3 card3";
            }
            
            .container.target-top {
                grid-template-columns: 1fr 1fr;
                grid-template-areas: 
                    "card3 card3"
                    "card1 card2"
                    "card4 card4";
            }
            
            .container.wide-first {
                grid-template-columns: 1fr 1fr;
                grid-template-areas: 
                    "card1 card1"
                    "card2 card3"
                    "card4 card4";
            }
        }

        .card {
            background-color: var(--card);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--accent);
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: var(--card);
            color: var(--text);
        }

        select:focus, input:focus, textarea:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 107, 47, 0.2);
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .orbit-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            font-weight: 600;
            margin-top: 10px;
        }

        button:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .results {
            background-color: var(--results-bg);
            padding: 20px;
            border-radius: 12px;
            min-height: 100px;
            overflow: auto;
            max-height: 500px;
            border: 1px solid var(--border);
            white-space: pre-line;
        }

        .error {
            color: var(--error);
            font-weight: bold;
            margin-top: 10px;
        }

        .hint {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 5px;
            font-style: italic;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--footer-color);
            font-size: 0.9rem;
        }

        /* Переработанные стили для бокового меню */
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1000;
            top: 0;
            right: 0;
            background-color: var(--sidebar-bg);
            overflow-x: hidden;
            transition: 0.3s;
            padding-top: 60px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }

        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 1.2rem;
            color: var(--text);
            display: block;
            transition: 0.3s;
        }

        .sidebar a:hover {
            background-color: rgba(99, 107, 47, 0.1);
        }

        .sidebar .closebtn {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            color: var(--accent);
            z-index: 1100;
        }

        /* Переработанная кнопка открытия меню */
        .openbtn {
            position: fixed;
            top: 30px;
            right: 30px;
            font-size: 1.8rem;
            cursor: pointer;
            background: transparent;
            border: none;
            color: var(--accent);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 900;
            opacity: 0.9;
            transform: scale(1);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(4px);
        }

        .openbtn:hover {
            opacity: 1;
            transform: scale(1.05);
            background: rgba(99, 107, 47, 0.15);
        }

        /* Скрыть кнопку при открытом меню */
        .sidebar-open .openbtn {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        /* Стили для переключателя тем */
        .theme-switch {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .theme-label {
            flex: 1;
            font-size: 1rem;
            margin-right: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-handle);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--toggle-bg);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Стили для переключателя порядка */
        .order-switch {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .order-label {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        /* Стили для переключателя языка */
        .language-switch {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .language-label {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        /* Стили для переключателя солнечной системы */
        .solarsystem-switch {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .solarsystem-label {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text);
        }

        #orderToggle, #languageToggle, #solarsystemToggle {
            width: 100%;
            padding: 10px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.95rem;
        }
        
        /* Контент бокового меню */
        .sidebar-content {
            margin-top: 40px;
            padding: 0 15px;
        }

        /* Стили для вывода характеристик */
        .orbit-characteristics {
            background-color: var(--results-bg);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95rem;
            border: 1px solid var(--border);
        }

        .characteristic-item {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .characteristic-label {
            font-weight: 600;
            color: var(--accent);
        }

        /* Параметры небесного тела в одну линию */
        .celestial-body-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Боковое меню -->
    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        
        <div class="sidebar-content">
            <!-- Переключатель солнечной системы -->
            <div class="solarsystem-switch">
                <span class="solarsystem-label" id="solarsystemLabel">Солнечная система:</span>
                <select id="solarsystemToggle"></select>
            </div>
            
            <div class="theme-switch">
                <span class="theme-label">Тёмная тема</span>
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
                <span class="theme-label">Светлая тема</span>
            </div>
            
            <!-- Переключатель порядка блоков -->
            <div class="order-switch">
                <span class="order-label">Порядок блоков:</span>
                <select id="orderToggle">
                    <option value="default">Стандартный</option>
                    <option value="results-top">Результаты сверху</option>
                    <option value="target-top">Целевая орбита сверху</option>
                    <option value="wide-first">Параметры тела сверху</option>
                </select>
            </div>
            
            <!-- Переключатель языка -->
            <div class="language-switch">
                <span class="language-label">Язык:</span>
                <select id="languageToggle">
                    <option value="ru">Человеческий</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Кнопка открытия меню -->
    <button class="openbtn" onclick="openNav()">☰</button>

    <header>
        <h1 id="appTitle">Orbital Calculator</h1>
        <div class="subtitle" id="appSubtitle">Расчёт орбитальных переходов для RSS</div>
    </header>
    
    <div class="container default">
        <div class="card">
            <h2 class="card-title" id="bodyParamsTitle">Параметры небесного тела</h2>
            
            <div class="celestial-body-group">
                <div class="form-group">
                    <label for="planet" id="planetLabel">Планета:</label>
                    <select id="planet"></select>
                </div>
                
                <div class="form-group" id="satellite-group">
                    <label for="satellite" id="satelliteLabel">Спутник:</label>
                    <select id="satellite"></select>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title" id="initialOrbitTitle">Начальная орбита</h2>
            
            <div class="orbit-inputs">
                <div class="form-group">
                    <label for="periapsisInit" id="periapsisInitLabel">Перицентр (км):</label>
                    <input type="number" id="periapsisInit" value="150">
                </div>
                
                <div class="form-group">
                    <label for="apoapsisInit" id="apoapsisInitLabel">Апоцентр (км):</label>
                    <input type="number" id="apoapsisInit" value="150">
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title" id="targetOrbitTitle">Целевая орбита</h2>
            
            <div class="orbit-inputs">
                <div class="form-group">
                    <label for="periapsisTarget" id="periapsisTargetLabel">Перицентр (км):</label>
                    <input type="number" id="periapsisTarget" value="150">
                </div>
                
                <div class="form-group">
                    <label for="apoapsisTarget" id="apoapsisTargetLabel">Апоцентр (км):</label>
                    <input type="number" id="apoapsisTarget" value="150">
                </div>
            </div>
            
            <!-- Блок для характеристик целевой орбиты -->
            <div id="targetCharacteristics" class="orbit-characteristics">
                <div class="characteristic-item">
                    <span class="characteristic-label" id="vPeriTargetLabel">Скорость в перицентре:</span>
                    <span id="vPeriTarget">-</span>
                </div>
                <div class="characteristic-item">
                    <span class="characteristic-label" id="vApoTargetLabel">Скорость в апоцентре:</span>
                    <span id="vApoTarget">-</span>
                </div>
                <div class="characteristic-item">
                    <span class="characteristic-label" id="periodTargetLabel">Период обращения:</span>
                    <span id="periodTarget">-</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title" id="resultsTitle">Результаты расчёта</h2>
            <div class="results" id="results">Введите параметры орбит и нажмите "Рассчитать"</div>
            <button id="calculateBtn">Рассчитать</button>
        </div>
    </div>
    
    <footer>
        Bong _Cat <span class="symbol">©</span> 1917 | Калькулятор орбитальных переходов
    </footer>

    <script>
        // Константы
        const G = 6.67430e-11; // Гравитационная постоянная

        // Солнечные системы
        const solarSystems = [
            {
                id: "rss",
                name: "РСС",
                name_en: "RSS",
                bodies: [
                    { 
                        name: 'Меркурий', 
                        name_en: 'Mercury', 
                        gm: 2.203178e13, 
                        radius: 2439.7,
                        satellites: [] 
                    },
                    { 
                        name: 'Венера',   
                        name_en: 'Venus',   
                        gm: 3.248586e14, 
                        radius: 6049.0,
                        satellites: [] 
                    },
                    { 
                        name: 'Земля',    
                        name_en: 'Earth',   
                        gm: 3.986004e14, 
                        radius: 6371.0,
                        satellites: [
                            { name: 'Луна', name_en: 'Moon', gm: 4.9048695e12, radius: 1737.4 }
                        ] 
                    },
                    { 
                        name: 'Марс',     
                        name_en: 'Mars',    
                        gm: 4.282831e13, 
                        radius: 3375.8,
                        satellites: [
                            { name: 'Фобос', name_en: 'Phobos', gm: 7.08e9, radius: 11.1 },
                            { name: 'Деймос', name_en: 'Deimos', gm: 1.48e9, radius: 6.2 }
                        ] 
                    },
                    { 
                        name: 'Юпитер',   
                        name_en: 'Jupiter', 
                        gm: 1.266865e17, 
                        radius: 69373.0,
                        satellites: [
                            { name: 'Ио', name_en: 'Io', gm: 5.959916e12, radius: 1821.6 },
                            { name: 'Европа', name_en: 'Europa', gm: 3.202739e12, radius: 1560.8 },
                            { name: 'Ганимед', name_en: 'Ganymede', gm: 9.887819e12, radius: 2631.2 },
                            { name: 'Каллисто', name_en: 'Callisto', gm: 7.179289e12, radius: 2410.3 }
                        ] 
                    },
                    { 
                        name: 'Сатурн',   
                        name_en: 'Saturn',  
                        gm: 3.793119e16, 
                        radius: 57216.0,
                        satellites: [
                            { name: 'Мимас', name_en: 'Mimas', gm: 2.503e9, radius: 198.2 },
                            { name: 'Энцелад', name_en: 'Enceladus', gm: 7.209e9, radius: 252.1 },
                            { name: 'Тефия', name_en: 'Tethys', gm: 4.121e10, radius: 533.0 },
                            { name: 'Диона', name_en: 'Dione', gm: 7.311e10, radius: 561.7 },
                            { name: 'Рея', name_en: 'Rhea', gm: 1.538e11, radius: 764.3 },
                            { name: 'Титан', name_en: 'Titan', gm: 8.978e12, radius: 2575.5 },
                            { name: 'Япет', name_en: 'Iapetus', gm: 1.205e11, radius: 735.6 }
                        ] 
                    },
                    { 
                        name: 'Уран',     
                        name_en: 'Uranus',  
                        gm: 5.793940e15, 
                        radius: 24702.0,
                        satellites: [
                            { name: 'Миранда', name_en: 'Miranda', gm: 4.4e9, radius: 235.8 },
                            { name: 'Ариэль', name_en: 'Ariel', gm: 1.35e11, radius: 578.9 },
                            { name: 'Умбриэль', name_en: 'Umbriel', gm: 1.17e11, radius: 584.7 },
                            { name: 'Титания', name_en: 'Titania', gm: 2.37e11, radius: 788.9 },
                            { name: 'Оберон', name_en: 'Oberon', gm: 2.01e11, radius: 761.4 }
                        ] 
                    },
                    { 
                        name: 'Нептун',   
                        name_en: 'Neptune', 
                        gm: 6.836530e15, 
                        radius: 24085.0,
                        satellites: [
                            { name: 'Тритон', name_en: 'Triton', gm: 1.428e12, radius: 1353.4 }
                        ] 
                    },
                    { 
                        name: 'Плутон',   
                        name_en: 'Pluto',   
                        gm: 8.71e11,     
                        radius: 1187.0,
                        satellites: [
                            { name: 'Харон', name_en: 'Charon', gm: 1.058e11, radius: 606.0 }
                        ] 
                    }
                ]
            },
            {
                id: "ksp",
                name: "Ванильная КСП",
                name_en: "Vanilla KSP",
                bodies: [
                    { 
                        name: 'Мохо', 
                        name_en: 'Moho', 
                        gm: 1.686093e11, 
                        radius: 250,
                        satellites: [] 
                    },
                    { 
                      name: 'Ева', 
                        name_en: 'Eve', 
                        gm: 8.17173e12, 
                        radius: 700,
                        satellites: [
                            { name: 'Гилли', name_en: 'Gilly', gm: 8.2894e6, radius: 13 }
                        ]  
                    },
                    { 
                        name: 'Кербин', 
                        name_en: 'Kerbin', 
                        gm: 3.5316e12, 
                        radius: 600,
                        satellites: [
                            { name: 'Муна', name_en: 'Mun', gm: 6.5138398e10, radius: 200 },
                            { name: 'Минмус', name_en: 'Minmus', gm: 1.7658e9, radius: 60 }
                        ] 
                    },
                    { 
                        name: 'Дюна', 
                        name_en: 'Duna', 
                        gm: 3.013632e11, 
                        radius: 320,
                        satellites: [
                            { name: 'Айк', name_en: 'Ike', gm: 1.856836e10, radius: 130 }
                        ] 
                    },
                    { 
                        name: 'Джул', 
                        name_en: 'Jool', 
                        gm: 2.82528e14, 
                        radius: 6000,
                        satellites: [
                            { name: 'Лейт', name_en: 'Laythe', gm: 1.962e12, radius: 500 },
                            { name: 'Валл', name_en: 'Vall', gm: 2.0748e11, radius: 300 },
                            { name: 'Тайло', name_en: 'Tylo', gm: 2.825e12, radius: 600 },
                            { name: 'Боп', name_en: 'Bop', gm: 2.486e9, radius: 65 },
                            { name: 'Пол', name_en: 'Pol', gm: 7.217e8, radius: 44 }
                        ] 
                    },
                    {
                        name_en: 'Eeloo',
                        name: 'Илу',
                        gm: 7.4410815e10,
                        radius: 210,
                        satellites: []
                    }
                ]
            },
            {
                id: "JNSQ",
                name: "ЖЕНЕСКЮ",
                name_en: "JNSQ",
                bodies: [
                    { 
                        name: 'Мохо', 
                        name_en: 'Moho', 
                        gm: 1.20156e12, 
                        radius: 652.3,
                        satellites: [] 
                    },
                    { 
                        name: 'Ева', 
                        name_en: 'Eve', 
                        gm: 5.76974e13, 
                        radius: 2052.0,
                        satellites: [
                            { name: 'Гилли', name_en: 'Gilly', gm: 6.61949e7, radius: 33.0 }
                        ] 
                    },
                    { 
                        name: 'Кербин', 
                        name_en: 'Kerbin', 
                        gm: 2.51050e13, 
                        radius: 1600.4,
                        satellites: [
                            { name: 'Муна', name_en: 'Mun', gm: 2.27514e11, radius: 401.1 },
                            { name: 'Минмус', name_en: 'Minmus', gm: 1.25525e10, radius: 160.3 }
                        ] 
                    },
                    { 
                        name: 'Дюна', 
                        name_en: 'Duna', 
                        gm: 2.13393e12, 
                        radius: 801.5,
                        satellites: [
                            { name: 'Айк', name_en: 'Ike', gm: 2.59484e10, radius: 211.1 }
                        ] 
                    },
                    { 
                        name: 'Эдна', 
                        name_en: 'Edna', 
                        gm: 5.30344e10, 
                        radius: 261.0,
                        satellites: [
                            { name: 'Дак', name_en: 'Dak', gm: 3.13813e7, radius: 26.1 }
                        ] 
                    },
                    { 
                        name: 'Дрес', 
                        name_en: 'Dres', 
                        gm: 1.52513e11, 
                        radius: 361.6,
                        satellites: [] 
                    },
                    { 
                        name: 'Джул', 
                        name_en: 'Jool', 
                        gm: 1.99899e15, 
                        radius: 14000.0,
                        satellites: [
                            { name: 'Лейт', name_en: 'Laythe', gm: 6.88231e12, radius: 1100.1 },
                            { name: 'Валл', name_en: 'Vall', gm: 5.33972e11, radius: 552.3 },
                            { name: 'Тайло', name_en: 'Tylo', gm: 2.54188e12, radius: 903.0 },
                            { name: 'Боп', name_en: 'Bop', gm: 1.77010e10, radius: 190.8 },
                            { name: 'Пол', name_en: 'Pol', gm: 4.97197e9, radius: 130.5 }
                        ] 
                    },
                    { 
                        name: 'Линдор', 
                        name_en: 'Lindor', 
                        gm: 5.89968e14, 
                        radius: 8000.0,
                        satellites: [
                            { name: 'Крел', name_en: 'Krel', gm: 6.61949e9, radius: 150.8 },
                            { name: 'Аден', name_en: 'Aden', gm: 6.17819e10, radius: 300.8 },
                            { name: 'Гюйген', name_en: 'Huygen', gm: 6.60331e11, radius: 670.9 },
                            { name: 'Рига', name_en: 'Riga', gm: 9.92923e11, radius: 751.4 },
                            { name: 'Талос', name_en: 'Talos', gm: 2.69683e11, radius: 501.3 }
                        ] 
                    },
                    { 
                        name: 'Илу', 
                        name_en: 'Eeloo', 
                        gm: 5.29559e11, 
                        radius: 602.6,
                        satellites: [
                            { name: 'Селес', name_en: 'Celes', gm: 1.56906e10, radius: 200.9 },
                            { name: 'Там', name_en: 'Tam', gm: 3.43233e6, radius: 13.6 }
                        ] 
                    },
                    { 
                        name: 'Хамек', 
                        name_en: 'Hamek', 
                        gm: 1.98585e11, 
                        radius: 451.3,
                        satellites: [] 
                    },
                    { 
                        name: 'Нара', 
                        name_en: 'Nara', 
                        gm: 1.27094e14, 
                        radius: 3601.6,
                        satellites: [
                            { name: 'Амос', name_en: 'Amos', gm: 6.02521e10, radius: 321.2 },
                            { name: 'Энон', name_en: 'Enon', gm: 7.20789e11, radius: 702.0 },
                            { name: 'Пракс', name_en: 'Prax', gm: 2.37321e9, radius: 110.5 }
                        ] 
                    }
                ]
            }
        ];

        // Тексты локализации
        const translations = {
            ru: {
                appTitle: "Орбитальный Калькулятор",
                appSubtitle: "Расчёт орбитальных переходов",
                bodyParamsTitle: "Параметры небесного тела",
                solarSystemLabel: "Солнечная система:",
                planetLabel: "Планета:",
                satelliteLabel: "Спутник:",
                initialOrbitTitle: "Начальная орбита",
                periapsisInitLabel: "Перицентр (км):",
                apoapsisInitLabel: "Апоцентр (км):",
                targetOrbitTitle: "Целевая орбита",
                periapsisTargetLabel: "Перицентр (км):",
                apoapsisTargetLabel: "Апоцентр (км):",
                vPeriTargetLabel: "Скорость в перицентре:",
                vApoTargetLabel: "Скорость в апоцентре:",
                periodTargetLabel: "Период обращения:",
                resultsTitle: "Результаты расчёта",
                calculateBtn: "Рассчитать",
                resultsDefault: "Введите параметры орбит и нажмите \"Рассчитать\"",
                orbitError: "Высота орбиты не может быть меньше радиуса небесного тела",
                calculateError: "Ошибка: ",
                themeLabelDark: "Тёмная тема",
                themeLabelLight: "Светлая тема",
                orderLabel: "Порядок блоков:",
                languageLabel: "Язык:",
                orderOptions: {
                    default: "Стандартный",
                    "results-top": "Результаты сверху",
                    "target-top": "Целевая орбита сверху",
                    "wide-first": "Параметры тела сверху"
                }
            },
            en: {
                appTitle: "Orbital Calculator",
                appSubtitle: "Orbital transfer calculation",
                bodyParamsTitle: "Celestial Body Parameters",
                solarSystemLabel: "Solar system:",
                planetLabel: "Planet:",
                satelliteLabel: "Satellite:",
                initialOrbitTitle: "Initial Orbit",
                periapsisInitLabel: "Periapsis (km):",
                apoapsisInitLabel: "Apoapsis (km):",
                targetOrbitTitle: "Target Orbit",
                periapsisTargetLabel: "Periapsis (km):",
                apoapsisTargetLabel: "Apoapsis (km):",
                vPeriTargetLabel: "Velocity at periapsis:",
                vApoTargetLabel: "Velocity at apoapsis:",
                periodTargetLabel: "Orbital period:",
                resultsTitle: "Calculation Results",
                calculateBtn: "Calculate",
                resultsDefault: "Enter orbit parameters and click \"Calculate\"",
                orbitError: "Orbit height cannot be less than celestial body radius",
                calculateError: "Error: ",
                themeLabelDark: "Dark theme",
                themeLabelLight: "Light theme",
                orderLabel: "Block order:",
                languageLabel: "Language:",
                orderOptions: {
                    default: "Default",
                    "results-top": "Results on top",
                    "target-top": "Target orbit on top",
                    "wide-first": "Body parameters on top"
                }
            }
        };

        // DOM элементы
        const solarsystemToggle = document.getElementById('solarsystemToggle');
        const planetSelect = document.getElementById('planet');
        const satelliteSelect = document.getElementById('satellite');
        const satelliteGroup = document.getElementById('satellite-group');
        const resultsDiv = document.getElementById('results');
        const calculateBtn = document.getElementById('calculateBtn');
        const themeToggle = document.getElementById('themeToggle');
        const languageToggle = document.getElementById('languageToggle');
        const bodyElement = document.body;
        const container = document.querySelector('.container');
        const orderToggle = document.getElementById('orderToggle');
        
        // Элементы характеристик целевой орбиты
        const vPeriTarget = document.getElementById('vPeriTarget');
        const vApoTarget = document.getElementById('vApoTarget');
        const periodTarget = document.getElementById('periodTarget');

        // Изменение порядка блоков
        function changeBlockOrder(order) {
            if (!container || !orderToggle) return;
            
            if (!order) {
                order = orderToggle.value;
            }
            
            // Удаляем все классы порядка
            container.classList.remove('default', 'results-top', 'target-top', 'wide-first');
            
            // Добавляем нужный класс
            if (order === 'results-top') {
                container.classList.add('results-top');
            } 
            else if (order === 'target-top') {
                container.classList.add('target-top');
            }
            else if (order === 'wide-first') {
                container.classList.add('wide-first');
            }
            else {
                container.classList.add('default');
            }
            
            // Сохраняем выбор в localStorage
            localStorage.setItem('blockOrder', order);
            if (orderToggle) {
                orderToggle.value = order;
            }
        }

        // Обновление текстов интерфейса
        function updateUITexts(lang) {
            const langData = translations[lang];
            
            // Обновляем заголовки и метки
            document.getElementById('appTitle').textContent = langData.appTitle;
            document.getElementById('appSubtitle').textContent = langData.appSubtitle;
            document.getElementById('bodyParamsTitle').textContent = langData.bodyParamsTitle;
            document.getElementById('solarsystemLabel').textContent = langData.solarSystemLabel;
            document.getElementById('planetLabel').textContent = langData.planetLabel;
            document.getElementById('satelliteLabel').textContent = langData.satelliteLabel;
            document.getElementById('initialOrbitTitle').textContent = langData.initialOrbitTitle;
            document.getElementById('periapsisInitLabel').textContent = langData.periapsisInitLabel;
            document.getElementById('apoapsisInitLabel').textContent = langData.apoapsisInitLabel;
            document.getElementById('targetOrbitTitle').textContent = langData.targetOrbitTitle;
            document.getElementById('periapsisTargetLabel').textContent = langData.periapsisTargetLabel;
            document.getElementById('apoapsisTargetLabel').textContent = langData.apoapsisTargetLabel;
            document.getElementById('vPeriTargetLabel').textContent = langData.vPeriTargetLabel;
            document.getElementById('vApoTargetLabel').textContent = langData.vApoTargetLabel;
            document.getElementById('periodTargetLabel').textContent = langData.periodTargetLabel;
            document.getElementById('resultsTitle').textContent = langData.resultsTitle;
            document.getElementById('calculateBtn').textContent = langData.calculateBtn;
            document.querySelector('.theme-label:nth-child(1)').textContent = langData.themeLabelDark;
            document.querySelector('.theme-label:nth-child(3)').textContent = langData.themeLabelLight;
            document.querySelector('.order-label').textContent = langData.orderLabel;
            document.querySelector('.language-label').textContent = langData.languageLabel;
            
            // Обновляем результаты по умолчанию
            if (resultsDiv.textContent.includes("Введите") || 
                resultsDiv.textContent.includes("Enter")) {
                resultsDiv.textContent = langData.resultsDefault;
            }
            
            // Обновляем опции порядка блоков
            const orderOptions = langData.orderOptions;
            Array.from(orderToggle.options).forEach(option => {
                option.textContent = orderOptions[option.value];
            });
        }

        // Обновление списка солнечных систем
        function populateSolarSystems() {
            const lang = localStorage.getItem('language') || 'ru';
            solarsystemToggle.innerHTML = '';
            
            solarSystems.forEach((system, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = lang === 'ru' ? system.name : system.name_en;
                solarsystemToggle.appendChild(option);
            });
        }

        // Обновление списка планет
        function updatePlanets() {
            const systemIndex = parseInt(solarsystemToggle.value);
            if (isNaN(systemIndex)) return;
            
            const system = solarSystems[systemIndex];
            const lang = localStorage.getItem('language') || 'ru';
            planetSelect.innerHTML = '';
            
            system.bodies.forEach((body, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = lang === 'ru' ? body.name : body.name_en;
                planetSelect.appendChild(option);
            });
            
            updateSatellites();
        }

        // Обновление списка спутников
        function updateSatellites() {
            const systemIndex = parseInt(solarsystemToggle.value);
            if (isNaN(systemIndex)) return;
            
            const planetIndex = parseInt(planetSelect.value);
            if (isNaN(planetIndex)) return;
            
            const system = solarSystems[systemIndex];
            const planet = system.bodies[planetIndex];
            const lang = localStorage.getItem('language') || 'ru';
            
            satelliteSelect.innerHTML = '<option value="-1">' + 
                (lang === 'ru' ? '(Сама планета)' : '(Planet itself)') + '</option>';
            
            if (planet.satellites && planet.satellites.length > 0) {
                planet.satellites.forEach((sat, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = lang === 'ru' ? sat.name : sat.name_en;
                    satelliteSelect.appendChild(option);
                });
                satelliteGroup.style.display = 'block';
            } else {
                satelliteGroup.style.display = 'none';
            }
        }

        // Функция смены языка
        function changeLanguage() {
            const lang = languageToggle.value;
            localStorage.setItem('language', lang);
            
            // Обновляем шрифт
            if (lang === 'ru') {
                bodyElement.classList.remove('english');
            } else {
                bodyElement.classList.add('english');
            }
            
            // Обновляем тексты интерфейса
            updateUITexts(lang);
            
            // Обновляем списки
            populateSolarSystems();
            updatePlanets();
            updateSatellites();
        }

        // Инициализация приложения
        function initApp() {
            // Восстановление языка
            const savedLang = localStorage.getItem('language') || 'ru';
            languageToggle.value = savedLang;
            
            // Настройка обработчиков событий
            solarsystemToggle.addEventListener('change', updatePlanets);
            planetSelect.addEventListener('change', updateSatellites);
            calculateBtn.addEventListener('click', calculate);
            
            // Обработка нажатия Enter
            document.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculate();
                }
            });
            
            // Обработка переключения темы
            themeToggle.addEventListener('change', toggleTheme);
            
            // Обработка переключения языка
            languageToggle.addEventListener('change', changeLanguage);
            
            // Обработка переключения порядка блоков
            orderToggle.addEventListener('change', () => changeBlockOrder());
            
            // Заполняем списки
            populateSolarSystems();
            updatePlanets();
            updateSatellites();
            
            // Восстановление темы из localStorage
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                if (themeToggle) themeToggle.checked = true;
            }
            
            // Восстановление порядка блоков из localStorage
            const savedOrder = localStorage.getItem('blockOrder');
            if (savedOrder) {
                changeBlockOrder(savedOrder);
            }
            
            // Восстановление выбранной солнечной системы
            const savedSolarSystem = localStorage.getItem('solarSystem');
            if (savedSolarSystem !== null) {
                solarsystemToggle.value = savedSolarSystem;
            }
            
            // Сохраняем выбор солнечной системы при изменении
            solarsystemToggle.addEventListener('change', function() {
                localStorage.setItem('solarSystem', this.value);
            });
            
            // Применяем сохраненный язык
            changeLanguage();
        }

        // Получение гравитационных параметров
        function getGravityParams() {
            const systemIndex = parseInt(solarsystemToggle.value);
            const planetIndex = parseInt(planetSelect.value);
            const satelliteIndex = parseInt(satelliteSelect.value);
            
            const system = solarSystems[systemIndex];
            const planet = system.bodies[planetIndex];
            
            // Если выбран спутник
            if (satelliteIndex >= 0) {
                return {
                    gm: planet.satellites[satelliteIndex].gm,
                    radius: planet.satellites[satelliteIndex].radius * 1000
                };
            }
            
            // Если выбрана сама планета
            return {
                gm: planet.gm,
                radius: planet.radius * 1000
            };
        }

        // Основная функция расчёта
        function calculate() {
            const lang = localStorage.getItem('language') || 'ru';
            const langData = translations[lang];
            
            try {
                // Получаем параметры небесного тела
                const { gm, radius: planetRadius } = getGravityParams();
                
                // Получаем параметры начальной орбиты
                let rPeriInit = parseFloat(document.getElementById('periapsisInit').value) * 1000 + planetRadius;
                let rApoInit = parseFloat(document.getElementById('apoapsisInit').value) * 1000 + planetRadius;
                
                // Получаем параметры целевой орбиты
                let rPeriTarget = parseFloat(document.getElementById('periapsisTarget').value) * 1000 + planetRadius;
                let rApoTarget = parseFloat(document.getElementById('apoapsisTarget').value) * 1000 + planetRadius;
                
                // Проверка параметров орбит
                if (rPeriInit <= planetRadius || rApoInit <= planetRadius || 
                    rPeriTarget <= planetRadius || rApoTarget <= planetRadius) {
                    throw new Error(langData.orbitError);
                }
                
                // Рассчитываем характеристики целевой орбиты
                const vPeriTargetVal = Math.sqrt(gm * (2 / rPeriTarget - 2 / (rPeriTarget + rApoTarget)));
                const vApoTargetVal = Math.sqrt(gm * (2 / rApoTarget - 2 / (rPeriTarget + rApoTarget)));
                const periodVal = 2 * Math.PI * Math.sqrt(Math.pow((rPeriTarget + rApoTarget) / 2, 3) / gm);
                
                // Обновляем характеристики целевой орбиты
                vPeriTarget.textContent = `${vPeriTargetVal.toFixed(2)} м/с`;
                vApoTarget.textContent = `${vApoTargetVal.toFixed(2)} м/с`;
                periodTarget.textContent = `${(periodVal / 60).toFixed(2)} мин`;
                
                // Форматируем результаты
                let result = `==== ${lang === 'ru' ? 'РЕЗУЛЬТАТЫ РАСЧЁТА' : 'CALCULATION RESULTS'} ====\n\n`;
                result += `${lang === 'ru' ? 'Тип манёвра' : 'Maneuver type'}: `;
                result += (Math.abs(rPeriInit - rPeriTarget) < 1 || Math.abs(rApoInit - rApoTarget) < 1) 
                    ? (lang === 'ru' ? 'Одноимпульсный' : 'Single-impulse') 
                    : (lang === 'ru' ? 'Двухимпульсный' : 'Two-impulse') + '\n';
                
                if (Math.abs(rPeriInit - rPeriTarget) < 1) {
                    // Перицентры совпадают
                    const vInit = Math.sqrt(gm * (2 / rPeriInit - 2 / (rPeriInit + rApoInit)));
                    const vTarget = Math.sqrt(gm * (2 / rPeriInit - 2 / (rPeriInit + rApoTarget)));
                    const deltaV = vTarget - vInit;
                    
                    result += `\n<span class="symbol">Δ</span>V: ${formatDeltaV(deltaV)} м/с\n`;
                    result += `${lang === 'ru' ? 'Точка импульса' : 'Impulse point'}: ${lang === 'ru' ? 'перицентр' : 'periapsis'}\n`;
                    
                } else if (Math.abs(rApoInit - rApoTarget) < 1) {
                    // Апоцентры совпадают
                    const vInit = Math.sqrt(gm * (2 / rApoInit - 2 / (rPeriInit + rApoInit)));
                    const vTarget = Math.sqrt(gm * (2 / rApoInit - 2 / (rPeriTarget + rApoInit)));
                    const deltaV = vTarget - vInit;
                    
                    result += `\n<span class="symbol">Δ</span>V: ${formatDeltaV(deltaV)} м/с\n`;
                    result += `${lang === 'ru' ? 'Точка импульса' : 'Impulse point'}: ${lang === 'ru' ? 'апоцентр' : 'apoapsis'}\n`;
                    
                } else {
                    // Двухимпульсный переход
                    const vInitPeri = Math.sqrt(gm * (2 / rPeriInit - 2 / (rPeriInit + rApoInit)));
                    const vTransferPeri = Math.sqrt(gm * (2 / rPeriInit - 2 / (rPeriInit + rApoTarget)));
                    const deltaV1 = vTransferPeri - vInitPeri;
                    
                    const vTransferApo = Math.sqrt(gm * (2 / rApoTarget - 2 / (rPeriInit + rApoTarget)));
                    const vTargetApo = Math.sqrt(gm * (2 / rApoTarget - 2 / (rPeriTarget + rApoTarget)));
                    const deltaV2 = vTargetApo - vTransferApo;
                    
                    const totalDeltaV = Math.abs(deltaV1) + Math.abs(deltaV2);
                    
                    result += `\n${lang === 'ru' ? 'Импульс 1 (перицентр)' : 'Impulse 1 (periapsis)'}: ${formatDeltaV(deltaV1)} м/с\n`;
                    result += `${lang === 'ru' ? 'Импульс 2 (апоцентр)' : 'Impulse 2 (apoapsis)'}: ${formatDeltaV(deltaV2)} м/с\n`;
                    result += `\n${lang === 'ru' ? 'Общий' : 'Total'} <span class="symbol">Δ</span>V: ${totalDeltaV.toFixed(2)} м/с\n`;
                }
                
                resultsDiv.innerHTML = result;
                
            } catch (error) {
                resultsDiv.innerHTML = `<span class="error">${langData.calculateError}${error.message}</span>`;
                // Сбрасываем характеристики при ошибке
                vPeriTarget.textContent = '-';
                vApoTarget.textContent = '-';
                periodTarget.textContent = '-';
            }
        }

        // Форматирование ΔV
        function formatDeltaV(value) {
            if (value >= 0) {
                return `<span style="color: #4caf50">+${value.toFixed(2)}</span>`;
            } else {
                return `<span style="color: #f44336">${value.toFixed(2)}</span>`;
            }
        }

        // Переключение темы
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            // Сохраняем выбор в localStorage
            if (document.body.classList.contains('light-theme')) {
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.setItem('theme', 'dark');
            }
        }

        // Управление боковым меню
        function openNav() {
            document.getElementById("mySidebar").style.width = "300px";
            bodyElement.classList.add('sidebar-open');
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
            bodyElement.classList.remove('sidebar-open');
        }

        // Инициализация приложения при загрузке
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
